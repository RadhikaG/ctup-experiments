cmake_minimum_required(VERSION 3.15)
project(deps-download NONE)

set(CMAKE_BUILD_TYPE RelWithDebInfo)
set(NPROC 2)

# Set the C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
# ExternalProject is used to build and manage the dependencies
include(ExternalProject)

# Build ctup, bear helps generate compile_commands.json
ExternalProject_Add(ctup
  SOURCE_DIR ${CMAKE_SOURCE_DIR}/deps/compile-time-urdf-parser
  CONFIGURE_COMMAND ""
  BUILD_COMMAND bear make -j${NPROC}
  BUILD_IN_SOURCE true
  INSTALL_COMMAND make
)

# Build CppADCodeGen, depends on CppAD
ExternalProject_Add(CppADCodeGen
    SOURCE_DIR ${CMAKE_SOURCE_DIR}/deps/CppADCodeGen
    BINARY_DIR ${CMAKE_BINARY_DIR}/CppADCodeGen
    CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${CMAKE_BINARY_DIR}/install/CppADCodeGen -DCMAKE_EXPORT_COMPILE_COMMANDS=1 -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
    BUILD_COMMAND make -j${NPROC}
    INSTALL_DIR ${CMAKE_BINARY_DIR}/install/CppADCodeGen
)

include_directories(${CMAKE_BINARY_DIR}/install/CppADCodeGen/include)
